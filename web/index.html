<!DOCTYPE html> 
<html> 
<head> 
  <title>NetTango Example</title>
  <link href="https://fonts.googleapis.com/css?family=Poppins" rel="stylesheet">   
  <link href="css/ntango.css" rel="stylesheet">
  <meta charset="utf-8">
  <!-- script src="lib/ntango.js"></script -->
</head>
<body>
  <div class="nt-container" style="height: 500px;">
    <canvas id="nt-workspace" width="800" height="400" style="background: #fef9f6;"></canvas>
  </div>
  <button onclick="saveRestore()">SAVE</button>

  <script type="application/dart" src="dart/ntango.dart"></script>
  <script src="packages/browser/dart.js"></script>
  <script src="js/ntango.js"></script>

  <script>

  var workspaceDefinition = {
    "expressions" : [
      { "name" : "true", "type" : "bool" },
      { "name" : "false", "type" : "bool" },
      { "name" : "AND", "type" : "bool", "arguments" : [ "bool", "bool"], "format" : "({0} and {1})" },
      { "name" : "OR", "type" : "bool", "arguments" : [ "bool", "bool" ], "format" : "({0} or {1})" },
      { "name" : "NOT", "type" : "bool", "arguments" : [ "bool"], "format" : "(not {0})" },
      { "name" : ">", "type" : "bool", "arguments" : [ "num", "num" ] },
      { "name" : ">=", "type" : "bool", "arguments" : [ "num", "num" ] },
      { "name" : "<", "type" : "bool", "arguments" : [ "num", "num" ] },
      { "name" : "<=", "type" : "bool", "arguments" : [ "num", "num" ] },
      { "name" : "!=", "type" : "bool", "arguments" : [ "num", "num" ] },
      { "name" : "=", "type" : "bool", "arguments" : [ "num", "num" ] },
      { "name" : "+", "type" : "num", "arguments" : [ "num", "num"] },
      { "name" : "-", "type" : "num", "arguments" : [ "num", "num"] },
      { "name" : "Ã—", "type" : "num", "arguments" : [ "num", "num"], "format" : "({0} * {1})" },
      { "name" : "/", "type" : "num", "arguments" : [ "num", "num"] },
      { "name" : "random", "type" : "num", "arguments" : [ "num" ], "format" : "random-float {0}" }
    ],

    "variables" : [
      { "name" : "energy", "type" : "num" },
      { "name" : "mouseX", "type" : "num" },
      { "name" : "mouseY", "type" : "num" }
    ],

    "blocks" : [
      {
        "action" : "\uD83D\uDC3A   wolf actions ",
        "type" : "nlogo:procedure",
        "start" : true,
        "limit" : 1,
        "format" : "to wolf-actions",
        "blockColor" : "#b55",
        "required" : true
      },

      {
        "action" : "wolf setup",
        "type" : "nlogo:procedure",
        "start" : true,
        "limit" : 1,
        "format" : "to wolf-setup",
        "blockColor" : "#b86f4c"
      },

      {
        "action" : "create wolves",
        "limit" : 1,
        "format" : "create-wolves {0} [ set size {P0} set color {P1} ]",
        "params" : [
          { "type" : "range", "min" : 0, "max" : 50, "step" : 1, "default" : 20, "name" : "count" }
        ],
        "properties" : [
          { "type" : "range", "name" : "size", "min" : "0.2", "max" : "5", "step" : 0.1, "default" : 1 },
          { "type" : "select", "name" : "color", "values" : [ "black", "brown", "red", "green", "blue", "yellow" ] },
          { "type" : "select", "name" : "position", "values" : [ "random", "centered"] }
        ]
      },
    
      {
        "action" : "\uD83D\uDC3A   forward",
        "format" : "forward {0}",
        "params" : [
          {
            "type" : "num",
            "name" : "steps",
            "default" : 2
          }
        ]
      },

      {
        "action" : "\uD83D\uDC3A   left",
        "format" : "left random {0}",
        "params" : [
          {
            "type" : "range",
            "min" : 0,
            "max" : 90,
            "step" : 1,
            "default" : 50,
            "random" : true,
            "name" : "amount",
            "unit" : "\u00B0"
          }
        ]
      },


      {
        "action" : "\uD83D\uDC3A   right",
        "format" : "right random {0}",
        "params" : [
          {
            "type" : "range",
            "min" : 0,
            "max" : 90,
            "step" : 1,
            "default" : 50,
            "random" : true,
            "name" : "amount",
            "unit" : "\u00B0"
          }
        ]
      },

      {
        "action" : "\uD83D\uDC3A   change energy",
        "format" : "set energy energy + {0}",
        "params" : [ { "type" : "range", "min" : -20, "max" : 20, "step" : 0.5, "default" : 1, "name" : "amount" }]
      },

      { 
        "action" : "\uD83D\uDC3A   hatch", 
        "format" : "hatch 1", 
        "blockColor" : "#916da0",
        "params" : [
          { "type" : "int", "min" : 1, "name" : "child count", "default" : 1 }
        ]
      },

      { 
        "action" : "die", 
        "blockColor" : "#916da0",
      },

      {
        "action" : "\uD83D\uDC3A   if",
        "format" : "if {0}",
        "blockColor" : "#89a",
        "params" : [
          {
            "type" : "bool",
            "name" : "check"
          }
        ],
        "clauses" : [ ]
      },

      {
        "action" : "\uD83D\uDC11   if sheep-here?",
        "format" : "if energy < 0",
        "blockColor" : "#89a",
        "clauses" : [ ]
      },

      {
        "action" : "\uD83D\uDC11   ask sheep-here",
        "blockColor" : "#89a",
        "format" : "ask sheep-here",
        "clauses" : [ ]
      },


      {
        "action" : "chance",
        "blockColor" : "#89a",
        "format" : "ifelse random 100 < {0}",
        "clauses" : [
          {
            "name" : "else",
            "action" : "chance-else",
            "format" : ""
          }
        ],
        "params" : [
          {
            "type" : "range",
            "min" : 0,
            "max" : 100,
            "step" : 0.5,
            "default" : 20,
            "unit" : "%",
            "name" : "percent"
          }
        ]
      }
    ]
  };

document.body.onload = function() {

  NetTango.init("nt-workspace", workspaceDefinition);

  NetTango.onProgramChanged("nt-workspace", function(canvasId) {
    var code = NetTango.exportCode(canvasId, "NetLogo");
    console.log(code);
  });

}


  function saveRestore() {
    var json = JSON.parse(NetTango.save('nt-workspace'));
    console.log(NetTango.save('nt-workspace'));
    var canvas = document.getElementById("nt-workspace");
    canvas.getAttributeNode("width").value = "800";
    canvas.getAttributeNode("height").value = "400";
    NetTango.init('nt-workspace', json);
  }
  </script>
</body>
</html>
